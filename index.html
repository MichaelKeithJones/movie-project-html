<!doctype html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0" />
        <title>Movie Project</title>
        <link rel="icon" type="image/x-icon" href="./img/icons8-popcorn-48.png">
        
        <style>
            /*-------------------------*\ 
            Import
            \*-------------------------*/

            @import url("https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300&display=swap");

            /*-------------------------*\ 
            General
            \*-------------------------*/

            :root{
                --poster-height: 300px;
            }
            * {
                padding: 0;
                margin: 0;
                font-family: 'Roboto Condensed', sans-serif;
            }

            /*-------------------------*\ 
            Carousel
            \*-------------------------*/
            .poster-carousel {
                height: var(--poster-height);
                /* 5 Poster -> Poster Width: 200px;  (200px * 5) + (16px margin * 4) = 1064px*/
                /* 3 Poster -> Poster Width: 200px;  (200px * 3) + (16px margin * 2) = 632px*/
                /* 1 Poster -> Poster Width: 200px;  (200px * 1) + (16px margin * 0) = 200px*/
                width: 1064px;
                position: relative;
                overflow: hidden;
                margin: 0 auto;
                z-index: 0;
            }
            .poster-gallery {
                list-style: none;
                position: absolute;
                z-index: 1;
                width: 100%;
                left: 0;
                margin: 0;
                padding: 0;
                transition: all 1s ease;
                display: flex;
            }
            .poster {
                display: inline-block;
                min-width: 200px;
                height:  var(--poster-height);
                margin-right: 1rem;
                background-color: transparent;
            }
            .poster img{
                width: 100%;
                height: 100%;
            }

            /*-------------------------*\ 
            Carousel Buttons
            \*-------------------------*/
            .carousel-buttons {
                position: absolute;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .left-button { background: linear-gradient(to left, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1)); }
            .right-button { background: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1)); }
            .arrow {
                color: white;
                width: 50px;
                height: 100%;
                font-size: 32px;
                border: none;
                opacity: 0;
                transition: all 0.5s ease;
                z-index: 11;
                cursor: pointer;
            }
            .arrow:hover { opacity: 1; }
            .stretch {
                display: inline-block;
                transform: scale(1, 3);
            }

            /*-------------------------*\ 
            Modal
            \*-------------------------*/

            /* Actually the overlay, padding-top positions modal box */
            #add-modal {
                display: none; /* Hidden by default */

                position: fixed; /* Stay in place */
                left: 0;
                top: 0;
                z-index: 50; /* Sit on top */

                width: 100%; /* Full width */
                height: 100%; /* Full height */

                background-color: rgba(0, 0, 0, 0.75); /* Black w/ opacity */

                padding-top: 100px; /* Location of the box */
            }

            #add-modal .content {
                position: relative;
                background-color: rgb(75, 75, 75);
                width: 800px;
                height: 650px;
                margin: auto;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.75), 0 6px 20px 0 rgba(0, 0, 0, 0.75);
                animation: modal-slide-down 0.5s ease;
            }

            @keyframes modal-slide-down {
                from { top: -300px; opacity: 0 }
                to { top: 0; opacity: 1 }
            }

            #add-modal .header {
                width: 100%;
                height: 450px;
                background-image: 
                linear-gradient(to bottom, transparent, rgb(0, 0, 0)),
                url(https://image.tmdb.org/t/p/original/xHRabofjmMGoIV3mb6xgy4nwOcS.jpg);
                background-repeat: no-repeat;
                background-size: contain;
                color: white;
            }

            #add-modal .close-button {
                color: white;
                position: absolute;
                right: 0;

                margin: 20px;

                font-size: 35px;
                line-height: 23px;

                text-align: center;
                background-color: black;
                border-radius: 50%;
                width: 28px;
                height: 28px; 
            }

            #add-modal .close-button:hover,
            #add-modal .close-button:focus {
                color: rgb(49, 49, 49);
                text-decoration: none;
                cursor: pointer;
            }

            #add-modal img {
                width: 100%;
                height: 100%;
            }

            #add-modal .body {
                width: 100%;
                height: 200px;
                background: rgb(0, 0, 0);
                color: white;
            }
        </style>
    </head>
    <body>

        <main>

            <div class="poster-carousel">
                <ul class="poster-gallery" id="poster-gallery-horror">
                </ul>
                <div class="carousel-buttons">
                  <button class="left-button arrow stretch">&lt</button>
                  <button class="right-button arrow stretch">&gt</button>
                </div>
            </div>
        
            <button id="add-modal-button">Open Modal</button>

            <div id="add-modal" class="overlay">
                <div class="content">
                    <div class="header">
                        <div class="title"></div>
                        <div class="close-button">&times</div>
                    </div>
                    <div class="body">
                        <div class="release-date"></div>
                        <div class="overview"></div>
                        <div class="language"></div>
                        <div class="genres"></div>
                    </div>
                </div>
            </div>

        </main>
        <footer>
            Loading...
        </footer> -->

        <script src="./key.js"></script>
        <script>
            "use strict";

            (() => {
                //--------------------------------//
                // Constant Variables
                //--------------------------------//
                const genre = {
                    '28':       'action',
                    '12':       'adventure',
                    '16':       'animation',
                    '35':       'comedy',
                    '80':       'crime',
                    '99':       'documentary',
                    '18':       'drama',
                    '10751':    'family',
                    '14':       'fantasy',
                    '36':       'history',
                    '27':       'horror',
                    '10402':    'music',
                    '9648':     'mystery',
                    '10749':    'romance',
                    '878':      'sci-fi',
                    '10770':    'tv-movie',
                    '53':       'thriller',
                    '10752':    'war',
                    '37':       'western'
                }

                const leftButtons = document.getElementsByClassName("left-button");
                const rightButtons = document.getElementsByClassName("right-button");

                const numOfPosters = 5;
                const carouselWidth = 1064;
                const posterMarginRight = 16;
                const posterCount = 20;
                const maxX = -((posterCount / numOfPosters) * carouselWidth + (posterMarginRight * (posterCount / numOfPosters)) - carouselWidth - posterMarginRight);

                const myMovieListUrl = `https://aluminum-purple-grouse.glitch.me/movies`;

                //--------------------------------//
                // Global Variables
                //--------------------------------//

                //--------------------------------//
                // Global Functions
                //--------------------------------//
                let capitalizeFirstLetter = string => string.charAt(0).toUpperCase() + string.slice(1);
                let convertTMDBGenreIDS = ids => ids.map(genreID => capitalizeFirstLetter(genre[genreID])).join(', ');

                function getCurrentTranslateXValue (element) {
                    var style = window.getComputedStyle(element);
                    var matrix = new WebKitCSSMatrix(style.transform);
                    return matrix.m41;
                }
                function moveCarouselLeft(e) {
                    e.target.removeEventListener('click', moveCarouselLeft);

                    let wrapper = e.target.parentElement.parentElement.firstElementChild;
                    const x = getCurrentTranslateXValue(wrapper);
                    const value = x + (carouselWidth + posterMarginRight);
                    if (x !== 0) wrapper.style.transform = `translateX(${value}px)`;

                    let startListening = () => { e.target.addEventListener("click", moveCarouselLeft); }
                    const myTimeout = setTimeout(startListening, 1000);
                }
                function moveCarouselRight(e) {
                    e.target.removeEventListener('click', moveCarouselRight);

                    let wrapper = e.target.parentElement.parentElement.firstElementChild;
                    const x = getCurrentTranslateXValue(wrapper);
                    const value = x - (carouselWidth + posterMarginRight);
                    if (x !== maxX) wrapper.style.transform = `translateX(${value}px)`;

                    let startListening = () => { e.target.addEventListener("click", moveCarouselRight); }
                    const myTimeout = setTimeout(startListening, 1000);
                }
                function buildCarousel(carouselGenre) {
                    let url = `https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_API_KEY}&with_genres=${carouselGenre}&sort_by=popularity.desc&language=en-US&page=1`;
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            document.getElementById(`poster-gallery-${genre[carouselGenre]}`).innerHTML = '';
                            data.results.forEach(movie => {
                                document.getElementById(`poster-gallery-${genre[carouselGenre]}`).innerHTML += `
                                    <div class="poster" data-target="poster">
                                        <img src="https://image.tmdb.org/t/p/original${movie.poster_path}">
                                        <span hidden>"https://image.tmdb.org/t/p/original${movie.poster_path}"</span>
                                        <span hidden>"https://image.tmdb.org/t/p/original${movie.backdrop_path}"</span>
                                        <span hidden>${movie.title}</span>
                                        <span hidden>${movie.release_date}</span>
                                        <span hidden>${movie.overview}</span>
                                        <span hidden>${movie.language}</span>
                                        <span hidden>${convertTMDBGenreIDS(movie.genre_ids)}</span>
                                        <span hidden>${movie.id}</span>
                                    </div>
                                `;
                            })
                        })
                        .catch(err => console.log(err));
                }
 
                //--------------------------------//
                // Event Handlers
                //--------------------------------// 

                Array.from(leftButtons).forEach(element => element.addEventListener("click", moveCarouselLeft));
                Array.from(rightButtons).forEach(element => element.addEventListener("click", moveCarouselRight));

                //--------------------------------//
                // Main Function
                //--------------------------------// 
                buildCarousel('27');                                            //-- '27' is genre code: Horror 

                const addModal = document.getElementById("add-modal");
                const addModalButton = document.getElementById("add-modal-button");
                const addModalCloseButton = document.getElementsByClassName("close-button")[0];

                addModalButton.addEventListener("click", () => { addModal.style.display = "block"; });
                addModalCloseButton.addEventListener("click", () => { addModal.style.display = "none"; });
                window.addEventListener("click", (event) => { if (event.target == addModal) addModal.style.display = "none"; });
            })();
        </script>
    </body>
</html>