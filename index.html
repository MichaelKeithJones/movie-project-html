<!doctype html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0" />
        <title>Movie Project</title>
        <link rel="icon" type="image/x-icon" href="./img/icons8-popcorn-48.png">
        
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300&display=swap");
            :root{
                --card-height: 300px;
            }
            * {
                padding: 0;
                margin: 0;
                font-family: 'Roboto Condensed', sans-serif;
            }
            .wrapper {
                height: var(--card-height);
                /* 5 Cards -> Card Width: 200px;  (200px * 5) + (16px margin * 4) = 1064px*/
                /* 3 Cards -> Card Width: 200px;  (200px * 3) + (16px margin * 2) = 632px*/
                /* 1 Cards -> Card Width: 200px;  (200px * 1) + (16px margin * 0) = 200px*/
                width: 1064px;
                position: relative;
                overflow: hidden;
                margin: 0 auto;
                z-index: 0;
            }
            .button-wrapper {
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: absolute;
            }
            .carousel {
                margin: 0;
                padding: 0;
                list-style: none;
                width: 100%;
                display: flex;
                position: absolute;
                left: 0;
                transition: all 1s ease;
                z-index: 1;
            }
            .card {
                background-color: transparent;
                min-width: 200px;
                height:  var(--card-height);
                margin-right: 1rem;
                display: inline-block;
            }
            .card img{
                width: 100%;
                height: 100%;
            }
            .card-inner {
                position: relative;
                width: 100%;
                height: 100%;
                text-align: center;
                transition: transform 1.5s;
                transform-style: preserve-3d;
                box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            }
            .card:hover .card-inner {
                transform: rotateY(180deg);
            }
            .card-front, .card-back {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
            }
            .card-front {
                background-color: black;
                color: white;
            }
            .card-back {
                padding: 5px;
                background-color: rgb(64, 64, 64);
                color: whitesmoke;
                transform: rotateY(180deg);
            }
            .card-text {
                padding: 5px;
                font-size: 13px;
            }
            .left { background: linear-gradient(to left, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1)); }
            .right { background: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1)); }
            .arrow-button {
                color: white;
                width: 50px;
                height: 100%;
                font-size: 32px;
                border: none;
                opacity: 0;
                transition: all 0.5s ease;
                z-index: 11;
            }
            .arrow-button:hover {
                opacity: 1;
            }
            .stretch {
                display: inline-block;
                transform: scale(1, 3);
            }
        </style>
    </head>
    <body>

        <main>

            <div class="wrapper">
                <ul class="carousel" data-target="horrorCarousel">
                </ul>
                <div class="button-wrapper">
                  <button class="left arrow-button stretch" data-action="slideLeft">&lt</button>
                  <button class="right arrow-button stretch" data-action="slideRight">&gt</button>
                </div>
            </div>
              
        </main>
        <footer>
            Loading...
        </footer> -->

        <script src="./key.js"></script>
        <script>
            "use strict";

            (() => {
                //--------------------------------//
                // Constant Variables
                //--------------------------------//
                const genre = {
                    'action':         '28',
                    'adventure':      '12',
                    'animation':      '16',
                    'comedy':         '35',
                    'crime':          '80',
                    'documentary':    '99',
                    'drama':          '18',
                    'family':         '10751',
                    'fantasy':        '14',
                    'history':        '36',
                    'horror':         '27',
                    'music':          '10402',
                    'mystery':        '9648',
                    'romance':        '10749',
                    'scienceFiction': '878',
                    'tVMovie':        '10770',
                    'thriller':       '53',
                    'war':            '10752',
                    'western':        '37'
                }

                const numOfCards = 5;

                const leftButtons = document.getElementsByClassName("left");
                const rightButtons = document.getElementsByClassName("right");

                const carouselWidth = 1064;
                const cardMarginRight = 16;
                const cardCount = 20;
                const maxX = -((cardCount / numOfCards) * carouselWidth + (cardMarginRight * (cardCount / numOfCards)) - carouselWidth - cardMarginRight);

                //--------------------------------//
                // Global Functions
                //--------------------------------//
                function getCurrentTranslateXValue (element) {
                    var style = window.getComputedStyle(element);
                    var matrix = new WebKitCSSMatrix(style.transform);
                    return matrix.m41;
                }
                function moveCarouselLeft(e) {
                    e.target.removeEventListener('click', moveCarouselLeft);

                    let wrapper = e.target.parentElement.parentElement.firstElementChild;
                    const x = getCurrentTranslateXValue(wrapper);
                    const value = x + (carouselWidth + cardMarginRight);
                    if (x !== 0) wrapper.style.transform = `translateX(${value}px)`;

                    let startListening = () => { e.target.addEventListener("click", moveCarouselLeft); }
                    const myTimeout = setTimeout(startListening, 1000);
                }
                function moveCarouselRight(e) {
                    e.target.removeEventListener('click', moveCarouselRight);

                    let wrapper = e.target.parentElement.parentElement.firstElementChild;
                    const x = getCurrentTranslateXValue(wrapper);
                    const value = x - (carouselWidth + cardMarginRight);
                    if (x !== maxX) wrapper.style.transform = `translateX(${value}px)`;

                    let startListening = () => { e.target.addEventListener("click", moveCarouselRight); }
                    const myTimeout = setTimeout(startListening, 1000);
                }

                let buildCarousel = carouselGenre => {
                    let url = `https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_API_KEY}&with_genres=${genre[carouselGenre]}&sort_by=popularity.desc&language=en-US&page=1`;
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            console.log(data.results);
                            let cards = '';
                            document.querySelector("[data-target='" + carouselGenre + "Carousel']").innerHTML = '';
                            data.results.forEach(movie => {
                                cards = `
                                    <div class="card" data-target="card">
                                        <div class="card-inner">
                                            <div class="card-front">
                                                <img src="https://image.tmdb.org/t/p/original${movie.poster_path}">
                                            </div>
                                            <div class="card-back">
                                                <h3>${movie.title}</h1> 
                                                <p class="card-text">Overview: ${movie.overview}</p>
                                                <p>Release Date: ${movie.release_date}</p> 
                                            </div>
                                        </div>
                                    </div>
                                `;
                                document.querySelector("[data-target='" + carouselGenre + "Carousel']").innerHTML += cards;
                            })
                        })
                        .catch(err => console.log(err));
                }
 

                //--------------------------------//
                // Event Handlers
                //--------------------------------// 

                Array.from(leftButtons).forEach(element => element.addEventListener("click", moveCarouselLeft));
                Array.from(rightButtons).forEach(element => element.addEventListener("click", moveCarouselRight));

                //--------------------------------//
                // Main Function
                //--------------------------------// 
                buildCarousel('horror');
            })();
        </script>
    </body>
</html>